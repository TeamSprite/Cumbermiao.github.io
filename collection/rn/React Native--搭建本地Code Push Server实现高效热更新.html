<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Cumber&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="Cumber,Cumbermiao,Cumber's Blog">
  
  <meta name="description" content="原文链接：https://www.jianshu.com/p/417a165ca9d7 React Native–搭建本地Code Push Server实现高效热更新   青苹果园 0.4 2018.07.03 10:57* 字数 1305  CodePush 简介 CodePush是一个微软开发的云服务器。通过它，开发者可以直接在用户的设备上部署手机应用更新。 CodePush相当于一个中心仓">
<meta property="og:type" content="website">
<meta property="og:title" content="Cumber&#39;s Blog">
<meta property="og:url" content="http://cumbermiao.github.io/collection/rn/React Native--搭建本地Code Push Server实现高效热更新.html">
<meta property="og:site_name" content="Cumber&#39;s Blog">
<meta property="og:description" content="原文链接：https://www.jianshu.com/p/417a165ca9d7 React Native–搭建本地Code Push Server实现高效热更新   青苹果园 0.4 2018.07.03 10:57* 字数 1305  CodePush 简介 CodePush是一个微软开发的云服务器。通过它，开发者可以直接在用户的设备上部署手机应用更新。 CodePush相当于一个中心仓">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://upload.jianshu.io/users/upload_avatars/877439/b5a70d3e-e99a-4a88-938c-5ea942e692e0.jpg?imageMogr2/auto-orient/strip%7CimageView2/1/w/96/h/96">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/877439-f9a0f09c0c7fa74b.jpeg">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/877439-b744444841ffde45.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/877439-6ab0dc8a040d4a10.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/877439-04591646072406f6.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/877439-bcf491ab1628d1e3.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/877439-ea2e36e1bb7d75c7.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/877439-3f3bc78525799752.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/877439-53a2b9d4842eec41.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/877439-3b7395c7ce012717.jpeg">
<meta property="og:updated_time" content="2019-04-18T09:06:58.700Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cumber&#39;s Blog">
<meta name="twitter:description" content="原文链接：https://www.jianshu.com/p/417a165ca9d7 React Native–搭建本地Code Push Server实现高效热更新   青苹果园 0.4 2018.07.03 10:57* 字数 1305  CodePush 简介 CodePush是一个微软开发的云服务器。通过它，开发者可以直接在用户的设备上部署手机应用更新。 CodePush相当于一个中心仓">
<meta name="twitter:image" content="http://upload.jianshu.io/users/upload_avatars/877439/b5a70d3e-e99a-4a88-938c-5ea942e692e0.jpg?imageMogr2/auto-orient/strip%7CimageView2/1/w/96/h/96">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>
  

  
  

</head>
</html>
<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">Cumber&#39;s Blog</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a href="/">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </a>
                    
                    <a href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>Archives</span>
                    </a>
                    
                    <a href="/about">
                        <i class="fa fa-user"></i>
                        <span>About</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        Cumber&#39;s Blog
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        专注前端发展
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="Cumbermiao" target="_blank" href="//cumbermiao.github.io">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="//github.com/cumbermiao">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="page-" class="article article-type-page" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    <div class="article-entry " itemprop="articleBody">
      
            
            <p>原文链接：<a href="https://www.jianshu.com/p/417a165ca9d7" target="_blank" rel="noopener">https://www.jianshu.com/p/417a165ca9d7</a></p>
<h1 id="React-Native–搭建本地Code-Push-Server实现高效热更新"><a href="#React-Native–搭建本地Code-Push-Server实现高效热更新" class="headerlink" title="React Native–搭建本地Code Push Server实现高效热更新"></a>React Native–搭建本地Code Push Server实现高效热更新</h1><p> <a href="/u/b534ce5f8fae"><img src="//upload.jianshu.io/users/upload_avatars/877439/b5a70d3e-e99a-4a88-938c-5ea942e692e0.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/96/h/96" alt="96"></a> </p>
<p><a href="/u/b534ce5f8fae">青苹果园</a></p>
<p>0.4 2018.07.03 10:57* 字数 1305</p>
<p><img src="//upload-images.jianshu.io/upload_images/877439-f9a0f09c0c7fa74b.jpeg" alt=""></p>
<h2 id="CodePush-简介"><a href="#CodePush-简介" class="headerlink" title="CodePush 简介"></a><a href="https://github.com/Microsoft/react-native-code-push" target="_blank" rel="noopener">CodePush</a> 简介</h2><blockquote>
<p>CodePush是一个微软开发的云服务器。通过它，开发者可以直接在用户的设备上部署手机应用更新。</p>
<p>CodePush相当于一个中心仓库，开发者可以推送当前的更新（包括JS/HTML/CSS/IMAGE等）到CoduPush，然后应用将会查询是否有更新。</p>
</blockquote>
<p>热更新的原理大致可以的理解为这样，由于 React Native 会将所有需要加载的 js 文件都打包在一个 bundle 文件中，而 app 运行时会加载该文件。所以，如果要升级 app，一个可行的思路就是动态替换该 bundle 文件，然后重启该 app 即可（如果修改了底层 native 代码则需要重新安装该 app ）。</p>
<p>实际上在开发时使用的更新模式就是上面所说的这种，直接替换 bundle 文件。开发环境时使用调试工具可以 Reload JS（替换 bundle 文件），但是在生产环境却不存在该调试工具，需要自己手动实现动态替换 bundle 的功能，而 CodePush 就是实现了该功能的一个工具。</p>
<p>然而 CodePush 服务器是在国外的，国内使用的话速度并不理想，所以自建本地CodePush 服务是最理想的。</p>
<h2 id="自建-CodePush-服务"><a href="#自建-CodePush-服务" class="headerlink" title="自建 CodePush 服务"></a>自建 CodePush 服务</h2><p>CodePush 服务主要分为三个部分：服务端、客户端、React Native 项目。</p>
<h3 id="一、服务端"><a href="#一、服务端" class="headerlink" title="一、服务端"></a>一、服务端</h3><p>服务端需要使用 <a href="https://github.com/lisong/code-push-server" target="_blank" rel="noopener">code-push-server</a> 和<a href="https://dev.mysql.com/downloads/mysql/5.6.html#downloads" target="_blank" rel="noopener">MySQL</a> 所以需要先将这两个安装好。</p>
<h4 id="1-安装MySQL"><a href="#1-安装MySQL" class="headerlink" title="1. 安装MySQL"></a>1. 安装MySQL</h4><ul>
<li>官网下载后直接双击安装，<a href="https://dev.mysql.com/downloads/mysql/5.6.html#downloads" target="_blank" rel="noopener">下载地址</a>；</li>
<li>打开“系统设置”，看到最新安装的MySQL，进入并启动服务。</li>
</ul>
<h4 id="2-安装-code-push-server"><a href="#2-安装-code-push-server" class="headerlink" title="2. 安装 code-push-server"></a>2. 安装 <a href="https://github.com/lisong/code-push-server" target="_blank" rel="noopener">code-push-server</a></h4><p>作者发布了两种安装方式（npm安装或源码安装），在此我推荐使用源码安装，为后期我们要基于这个服务修改自己的网页，源码安装方便些。</p>
<ul>
<li><p>(1)、下载code-push-server代码</p>
<p>// clone代码<br>git clone <a href="https://github.com/lisong/code-push-server.git" target="_blank" rel="noopener">https://github.com/lisong/code-push-server.git</a></p>
<p>// 进入项目并安装资源<br>cd code-push-server &amp;&amp; npm install</p>
</li>
</ul>
<ul>
<li><p>(2)、修改config/config.js 文件，在 db 对象中添加数据库信息，参考如下：</p>
<p> db: {</p>
<pre><code>username: process.env.RDS_USERNAME || &quot;root&quot;, // 数据库账户
password: process.env.RDS_PASSWORD || &quot;root&quot;, // 数据库账户密码
database: process.env.DATA_BASE || &quot;codepush&quot;, // 新建的数据库表名
host: process.env.RDS_HOST || &quot;127.0.0.1&quot;,
port: process.env.RDS_PORT || 3306,
dialect: &quot;mysql&quot;,
logging: false
</code></pre><p>  },</p>
</li>
</ul>
<ul>
<li><p>(3)、创建数据库表</p>
<p>// 初始化mysql数据库<br>./bin/db init –dbhost localhost –dbuser root –dbpassword 数据库密码</p>
<p>eg..<br>./bin/db init –dbhost 127.0.0.1 –dbuser root –dbpassword  root</p>
</li>
</ul>
<p><img src="//upload-images.jianshu.io/upload_images/877439-b744444841ffde45.png" alt=""></p>
<ul>
<li>(4)、配置打包后的，bundle存储地址，这里配置loal本地也可以配置<a href="http://www.qiniu.com/" target="_blank" rel="noopener">qiniu</a>和<a href="https://www.aliyun.com/product/oss" target="_blank" rel="noopener">OSS</a></li>
</ul>
<p>创建<code>storage</code>和<code>data</code>文件夹，用来保存打包好的资源，供用户更新下载，<code>downloadUrl</code>地址必须为服务器所在的地址，不然用户无法下载到包。主要配置如下：</p>
<pre><code> // 如果存储类型“storageType”为“qiniu”如果更新包放在七牛，需要配置相关信息 (http://www.qiniu.com/) 。
qiniu: {
  accessKey: &quot;&quot;,
  secretKey: &quot;&quot;,
  bucketName: &quot;&quot;,
  downloadUrl: &quot;&quot; //文件下载域名地址
},

//阿里云存储配置 当storageType为oss时需要配置
oss: {
  accessKeyId: &quot;&quot;,
  secretAccessKey: &quot;&quot;,
  endpoint: &quot;&quot;,
  bucketName: &quot;code-push-server&quot;,
  prefix: &quot;storage&quot;, // Key prefix in object key
  downloadUrl: &quot;https://code-push-server.oss-cn-shenzhen.aliyuncs.com/storage&quot;, // binary files download host address.
},

//文件存储在本地配置 当storageType为local时需要配置
local: {
  storageDir: &quot;/Users/lisilong/Desktop/workspaces/storage&quot;,
  //文件下载地址 CodePush Server 地址 + &apos;/download&apos; download对应app.js里面的地址
  downloadUrl: &quot;http://localhost:3000/download&quot;,
  // public static download spacename.
  public: &apos;/download&apos;
},

jwt: {
  // 登录jwt签名密钥，必须更改，否则有安全隐患，可以使用随机生成的字符串
  // Recommended: 63 random alpha-numeric characters
  // Generate using: https://www.grc.com/passwords.htm
  tokenSecret: &apos;INSERT_RANDOM_TOKEN_KEY&apos;
},

common: {
  dataDir: &quot;/Users/lisilong/Desktop/workspaces/data&quot;,
  //选择存储类型，目前支持local,oss,qiniu,s3配置
  storageType: &quot;local&quot;
},
</code></pre><ul>
<li><p>(5)、改好之后，启动服务</p>
<p>// 在根目录中执行<br>./bin/www</p>
</li>
</ul>
<p><img src="//upload-images.jianshu.io/upload_images/877439-6ab0dc8a040d4a10.png" alt=""></p>
<p>在浏览其中输入：<a href="http://127.0.0.1:3000" target="_blank" rel="noopener">http://127.0.0.1:3000</a> 能加载到CodePushServer登录界面即表示启动完成。</p>
<h2 id="二-客户端"><a href="#二-客户端" class="headerlink" title="二.客户端"></a>二.客户端</h2><h3 id="1-客户端需要安装-code-push-cli-参考文档"><a href="#1-客户端需要安装-code-push-cli-参考文档" class="headerlink" title="1. 客户端需要安装 code-push-cli 参考文档"></a>1. 客户端需要安装 code-push-cli <a href="https://github.com/lisong/code-push-server/blob/master/docs/react-native-code-push.md" target="_blank" rel="noopener">参考文档</a></h3><pre><code>npm install -g code-push-cli
</code></pre><h3 id="2-登录code-push-server，使code-push和自建的服务器关联"><a href="#2-登录code-push-server，使code-push和自建的服务器关联" class="headerlink" title="2. 登录code-push-server，使code push和自建的服务器关联"></a>2. 登录code-push-server，使code push和自建的服务器关联</h3><p>执行命令查看当前是否登录，因为是新服务，所以要先保证没有别的账号正在登录</p>
<pre><code>code-push whoami
</code></pre><p>如果报错如下，表示没有登录</p>
<pre><code>[Error]  You are not currently logged in. Run the &apos;code-push login&apos; command to authenticate with the CodePush server.
</code></pre><p>如果没有报错 并且显示邮箱账号，则表示已经登录账户，则我们要先注销当前账号</p>
<pre><code>code-push logout
</code></pre><p>成功注销后执行登录指令，浏览器会自动打开本地服务登录页面，命令行中会提示输入key。默认账号和密码为： admin 123456， 登录后获取token 并复制token到命令行中，并回车确认</p>
<pre><code>code-push login http://localhost:3000

//提示此表示登录成功
Successfully logged-in…… 
</code></pre><h3 id="3-创建应用，获取-DeploymentKey"><a href="#3-创建应用，获取-DeploymentKey" class="headerlink" title="3. 创建应用，获取 DeploymentKey"></a>3. 创建应用，获取 DeploymentKey</h3><pre><code>Usage: code-push app add &lt;appName&gt; &lt;os&gt; &lt;platform&gt;
选项：
  -v, --version  显示版本号  [布尔]

示例：
  app add MyApp ios react-native      Adds app &quot;MyApp&quot;, indicating that it&apos;s an iOS React Native app
  app add MyApp windows react-native  Adds app &quot;MyApp&quot;, indicating that it&apos;s a Windows React Native app
  app add MyApp android cordova       Adds app &quot;MyApp&quot;, indicating that it&apos;s an Android Cordova app

e.g..
code-push app add ReactNativeCodePushDemo-ios ios react-native
</code></pre><p>结果如下：</p>
<pre><code>│   Name     │ Deployment Key                        │
├────────────┼───────────────────────────────────────┤
│ Production │ EoQ6vVQ19YYXH18JxnoOVDsYtAcT4ksvOXqog │
├────────────┼───────────────────────────────────────┤
│ Staging    │ YO4pnZs4ePEG2F8p7dPWnS3oHDg74ksvOXqog │
</code></pre><p>其中Production对应的是生产的Deployment Key，Staging是开发时使用。</p>
<p><strong>可以通过命令行查看</strong>，<a href="https://github.com/Microsoft/react-native-code-push/blob/master/docs/setup-ios.md" target="_blank" rel="noopener">更多相关命令，请查阅官方文档</a></p>
<pre><code>code-push deployment ls XunHuiFinance-ios -k
</code></pre><p><img src="//upload-images.jianshu.io/upload_images/877439-04591646072406f6.png" alt=""></p>
<h2 id="三、React-Native-项目端"><a href="#三、React-Native-项目端" class="headerlink" title="三、React Native 项目端"></a>三、React Native 项目端</h2><h3 id="1-安装-react-native-code-push"><a href="#1-安装-react-native-code-push" class="headerlink" title="1. 安装 react-native-code-push"></a>1. 安装 react-native-code-push</h3><pre><code>// 项目中导入CodePush代码
npm install --save react-native-code-push
// 关联我们的项目
react-native link react-native-code-push
</code></pre><h3 id="2-可以把检测更新的入口，添加到componentDidMount方法中："><a href="#2-可以把检测更新的入口，添加到componentDidMount方法中：" class="headerlink" title="2.可以把检测更新的入口，添加到componentDidMount方法中："></a>2.可以把检测更新的入口，添加到componentDidMount方法中：</h3><pre><code>componentDidMount() {
    CodePush.sync({
        //启动模式三种：ON_NEXT_RESUME、ON_NEXT_RESTART、IMMEDIATE
        installMode: CodePush.InstallMode.ON_NEXT_RESTART,
        // 苹果公司和中国区安卓的热更新，是不允许弹窗提示的，所以不能设置为true
        updateDialog: false  
    });
}
</code></pre><h3 id="3-Android端配置"><a href="#3-Android端配置" class="headerlink" title="3. Android端配置"></a>3. Android端配置</h3><ul>
<li><p>(1)、settings.gradle加入：</p>
<p>include ‘:react-native-code-push’<br>project(‘:react-native-code-push’).projectDir = new File(rootProject.projectDir, ‘../node_modules/react-native-code-push/android/app’)</p>
</li>
</ul>
<ul>
<li><p>(2)、build.gradle修改：</p>
<p>apply from: “../../node_modules/react-native-code-push/android/codepush.gradle”</p>
<p>dependencies {</p>
<pre><code>compile fileTree(dir: &quot;libs&quot;, include: [&quot;*.jar&quot;])
compile &quot;com.android.support:appcompat-v7:23.0.1&quot;
compile &quot;com.facebook.react:react-native:+&quot;  // From node_modules
compile project(&apos;:react-native-code-push&apos;)
</code></pre><p>}</p>
</li>
</ul>
<ul>
<li><p>(3)、MainApplication文件下修改</p>
<p> private final ReactNativeHost mReactNativeHost = new ReactNativeHost(this) {</p>
<p>   @Override<br>   protected String getJSBundleFile() {</p>
<pre><code>return CodePush.getJSBundleFile();
</code></pre><p>   }</p>
<pre><code>@Override
public boolean getUseDeveloperSupport() {
  return BuildConfig.DEBUG;
}

//第一个参数是刚刚申请的key（可以根据环境配置）
//第三个参数是服务器的URL
@Override
protected List&lt;ReactPackage&gt; getPackages() {
  return Arrays.&lt;ReactPackage&gt;asList(
      new MainReactPackage(),
      new CodePush(&quot; nJ3oSQmb64bxRqTP9mwMhZuZLIm94ksvOXqog &quot;, MainApplication.this, BuildConfig.DEBUG,&quot;http://你的IP:端口/&quot;)
  );
}
</code></pre></li>
</ul>
<ul>
<li>(4)、修改版本号</li>
</ul>
<p>将 android/app/build.gradle 中的 <code>android.defaultConfig.versionName</code> 改成3位数的版本号（默认是1.0，但是codepush需要三位数）。</p>
<pre><code>android{
    defaultConfig{
        versionName &quot;1.0.0&quot;
    }
}
</code></pre><h3 id="4-iOS端配置"><a href="#4-iOS端配置" class="headerlink" title="4. iOS端配置"></a>4. iOS端配置</h3><ul>
<li>(1)、info.plist配置</li>
</ul>
<p><img src="//upload-images.jianshu.io/upload_images/877439-bcf491ab1628d1e3.png" alt=""></p>
<p>1</p>
<p><img src="//upload-images.jianshu.io/upload_images/877439-ea2e36e1bb7d75c7.png" alt=""></p>
<p>2</p>
<p>CodePushDeploymentKey 即为我们注册APP时获得的key，更加开发还是生产来分别设置；CodePushServerURL对应的是我们的bundle更新包的下载地址。这里因为用的是真机调试，所以配置了服务器的ip地址。</p>
<ul>
<li>(2)、开发阶段可以先直接使用CodePush:</li>
</ul>
<p><img src="//upload-images.jianshu.io/upload_images/877439-3f3bc78525799752.png" alt=""></p>
<ul>
<li>(3)、改成3位数的项目版本号</li>
</ul>
<h2 id="四、发布更新"><a href="#四、发布更新" class="headerlink" title="四、发布更新"></a>四、发布更新</h2><h3 id="发布更新："><a href="#发布更新：" class="headerlink" title="发布更新："></a>发布更新：</h3><pre><code>// 可以使用code-push release-react --help查看语法
code-push release-react --help

/ 发布命令（打包文件并上传到服务器）
$ code-push release-react &lt;appName&gt; &lt;OS&gt; &lt;updateContents&gt; &lt;deploymentNmae&gt; &lt;description&gt; &lt;disabled&gt; &lt;mandatory&gt;
&lt;appName&gt; //必须 app名称
&lt;OS&gt; //必须 发布平台iOS/Android
&lt;updateContents&gt; //非必须 Bundle文件所在目录
&lt;targetBinaryVersion&gt; //非必须 需要热更的app 版本
&lt;deploymentNmae&gt; //必须 需要发布的部署
&lt;description&gt; //非必须 描述 (更新客户端不可见必须有&quot;hide&quot;  eg: --description &quot;hide xxxx&quot;)
&lt;disabled&gt; //非必须 该版本客户端是否可以获得更新,默认为false
&lt;mandatory&gt; //非必须  如果有则表示app强制更新

code-push release-react ReactNativeCodePushDemo-ios ios -t &quot;1.0.0&quot; --des &quot;测试热更 新&quot; -d Staging
</code></pre><p>发布成功后，可以在文件夹中看到，等待被用户下载的bundle文件。</p>
<p><img src="//upload-images.jianshu.io/upload_images/877439-53a2b9d4842eec41.png" alt=""></p>
<h3 id="查看历史版本"><a href="#查看历史版本" class="headerlink" title="查看历史版本"></a>查看历史版本</h3><pre><code>// code-push deployment history &lt;应用名&gt; Staging/Production
code-push deployment history ReactNativeDemo-ios Staging
</code></pre><h3 id="清空历史版本"><a href="#清空历史版本" class="headerlink" title="清空历史版本"></a>清空历史版本</h3><pre><code>code-push deployment clear ReactNativeDemo-ios Staging
</code></pre><h3 id="案例："><a href="#案例：" class="headerlink" title="案例："></a>案例：</h3><ul>
<li>运行项目；</li>
<li>修改RN项目；</li>
<li>执行发布更新；</li>
<li>点击<code>Press for dialog-driven sync</code>按钮，弹框提示更新；</li>
<li>点击“后台更新”，即完成更新后刷新界面。</li>
</ul>
<p><img src="//upload-images.jianshu.io/upload_images/877439-3b7395c7ce012717.jpeg" alt=""></p>
<p>效果图</p>
<p>参考文章：<br><a href="https://github.com/lisong/code-push-server" target="_blank" rel="noopener">lisong的github</a><br><a href="https://github.com/Microsoft/code-push/blob/master/cli/README-cn.md#%E5%8F%91%E5%B8%83%E6%9B%B4%E6%96%B0-general" target="_blank" rel="noopener">Microsoft Code Push</a><br><a href="http://ibloodline.com/articles/2017/10/20/code-push.html" target="_blank" rel="noopener">Bloodline’s Blog</a><br><a href="https://blog.xgy666.cn/2017/03/21/using-code-push-to-build-rn-hot-update/" target="_blank" rel="noopener">孜孜不倦的blog</a><br><a href="https://www.jianshu.com/p/eb7fdee307dc" target="_blank" rel="noopener">花儿的爸爸</a><br><a href="https://www.jianshu.com/p/ca4beb5973bb" target="_blank" rel="noopener">https://www.jianshu.com/p/ca4beb5973bb</a></p>

            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2019年04月18日 17:06</p>
        <p>原始链接： <a class="post-url" href="/collection/rn/React Native--搭建本地Code Push Server实现高效热更新.html" title="">http://cumbermiao.github.io/collection/rn/React Native--搭建本地Code Push Server实现高效热更新.html</a></p>
        <footer>
            <a href="http://cumbermiao.github.io">
                <img src="/images/logo.png" alt="Cumbermiao">
                Cumbermiao
            </a>
        </footer>
    </div>
</div>

      
        
            
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;">赏</a>
</div>

<div id="reward" class="post-modal reward-lay">
    <a class="close" href="javascript:;" id="reward-close">×</a>
    <span class="reward-title">
        <i class="icon icon-quote-left"></i>
        请我吃糖~
        <i class="icon icon-quote-right"></i>
    </span>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/images/wechat.jpg" alt="打赏二维码">
        </div>
        <div class="reward-select">
            
            <label class="reward-select-item checked" data-id="wechat" data-wechat="/images/wechat.jpg">
                <img class="reward-select-item-wechat" src="/images/wechat.png" alt="微信">
            </label>
            
            
            <label class="reward-select-item" data-id="alipay" data-alipay="/images/alipay.jpg">
                <img class="reward-select-item-alipay" src="/images/alipay.png" alt="支付宝">
            </label>
            
        </div>
    </div>
</div>


        
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://cumbermiao.github.io/collection/rn/React Native--搭建本地Code Push Server实现高效热更新.html&title=Cumber's Blog&pic=http://cumbermiao.github.ioimages/logo.png" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://cumbermiao.github.io/collection/rn/React Native--搭建本地Code Push Server实现高效热更新.html&title=Cumber's Blog&source=专注前端" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://cumbermiao.github.io/collection/rn/React Native--搭建本地Code Push Server实现高效热更新.html" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=Cumber's Blog&url=http://cumbermiao.github.io/collection/rn/React Native--搭建本地Code Push Server实现高效热更新.html&via=http://cumbermiao.github.io" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://cumbermiao.github.io/collection/rn/React Native--搭建本地Code Push Server实现高效热更新.html" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://cumbermiao.github.io/collection/rn/React Native--搭建本地Code Push Server实现高效热更新.html" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#React-Native–搭建本地Code-Push-Server实现高效热更新"><span class="post-toc-text">React Native–搭建本地Code Push Server实现高效热更新</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#CodePush-简介"><span class="post-toc-text">CodePush 简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#自建-CodePush-服务"><span class="post-toc-text">自建 CodePush 服务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#一、服务端"><span class="post-toc-text">一、服务端</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-安装MySQL"><span class="post-toc-text">1. 安装MySQL</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-安装-code-push-server"><span class="post-toc-text">2. 安装 code-push-server</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二-客户端"><span class="post-toc-text">二.客户端</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-客户端需要安装-code-push-cli-参考文档"><span class="post-toc-text">1. 客户端需要安装 code-push-cli 参考文档</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-登录code-push-server，使code-push和自建的服务器关联"><span class="post-toc-text">2. 登录code-push-server，使code push和自建的服务器关联</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-创建应用，获取-DeploymentKey"><span class="post-toc-text">3. 创建应用，获取 DeploymentKey</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三、React-Native-项目端"><span class="post-toc-text">三、React Native 项目端</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-安装-react-native-code-push"><span class="post-toc-text">1. 安装 react-native-code-push</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-可以把检测更新的入口，添加到componentDidMount方法中："><span class="post-toc-text">2.可以把检测更新的入口，添加到componentDidMount方法中：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-Android端配置"><span class="post-toc-text">3. Android端配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-iOS端配置"><span class="post-toc-text">4. iOS端配置</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#四、发布更新"><span class="post-toc-text">四、发布更新</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#发布更新："><span class="post-toc-text">发布更新：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查看历史版本"><span class="post-toc-text">查看历史版本</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#清空历史版本"><span class="post-toc-text">清空历史版本</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#案例："><span class="post-toc-text">案例：</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>
    



    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style="display:none">
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style="display:none">
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2019 Cumbermiao<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "http://cumbermiao.github.io",
      animate: true,
      isHome: false,
      share: true,
      reward: 1
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/Jasmine/" style="font-size: 10px;">Jasmine</a> <a href="/tags/git/" style="font-size: 20px;">git</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a href="/">
                    <i class="fa fa-home"></i><span>Home</span>
                </a>
            </li>
            
            <li>
                <a href="/archives">
                    <i class="fa fa-archive"></i><span>Archives</span>
                </a>
            </li>
            
            <li>
                <a href="/about">
                    <i class="fa fa-user"></i><span>About</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/Jasmine/" style="font-size: 10px;">Jasmine</a> <a href="/tags/git/" style="font-size: 20px;">git</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
<script src="/js/search.js"></script>
<script src="/js/main.js"></script>


  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  <script src="/js/particles.js"></script>







  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  <script src="/js/animate.js"></script>


  <script src="/js/pop-img.js"></script>
  <script>
     $(".article-entry p img").popImg();
  </script>

  </div>
</body>
</html>